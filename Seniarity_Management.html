<div id="app">
    <h1>NAD Seniority & Promotion Management System</h1>
    
    <!-- Token Number Search -->
    <div>
        <h2>1. Token Number Search</h2>
        <input type="text" id="token-input" placeholder="Enter Token Number">
        <button onclick="searchByToken()">Search</button>
        <div id="token-results"></div>
    </div>
    
    <!-- Combine Posts -->
    <div>
        <h2>2. Combine Posts Seniority View</h2>
        <select id="post1-select"></select>
        <select id="post2-select"></select>
        <select id="rank-select">
            <option value="">All Ranks</option>
            <option value="SK">SK</option>
            <option value="HSK II">HSK II</option>
            <option value="HSK I">HSK I</option>
            <option value="MCM">MCM</option>
        </select>
        <button onclick="combinePosts()">Combine Posts</button>
        <div id="combine-results"></div>
    </div>
    
    <!-- Retirement Search -->
    <div>
        <h2>3. Dynamic Retirement Search</h2>
        <input type="number" id="retirement-year" placeholder="Year (e.g., 2035)">
        <select id="retirement-post1"></select>
        <select id="retirement-post2">
            <option value="">No second post</option>
        </select>
        <select id="retirement-rank1">
            <option value="">All Ranks</option>
            <option value="SK">SK</option>
            <option value="HSK II">HSK II</option>
            <option value="HSK I">HSK I</option>
            <option value="MCM">MCM</option>
        </select>
        <select id="retirement-rank2">
            <option value="">No second rank</option>
        </select>
        <button onclick="searchRetirements()">Search Retirements</button>
        <div id="retirement-results"></div>
    </div>
</div>

<script>
// Extract Sheet ID from the provided URL
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1_qwciFgPC98jL9-4j4p7qLTK639xF0Gkrddp9E4bGQo/edit?usp=drivesdk';
const SPREADSHEET_ID = SHEET_URL.split('/')[5];
const API_KEY = 'AIzaSyDxJaP_1q8J0q4tHKnQeQbQjZQJwYVH2F8'; // Replace with your actual API key

let employeeData = [];
let columnMapping = {};
let sanctionedPosts = {};

// Initialize when page loads
window.onload = function() {
    loadData();
};

// Load data from Google Sheets
async function loadData() {
    try {
        // Load employee data
        const range = 'Sheet1!A1:Z'; // Adjust sheet name if needed
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`;
        const response = await fetch(url);
        const json = await response.json();
        
        if (!json.values || json.values.length < 2) {
            throw new Error('No data found in sheet');
        }
        
        // Dynamically map columns based on header row
        const headers = json.values[0];
        columnMapping = {
            tokenNo: headers.indexOf('Token No'),
            name: headers.indexOf('Name'),
            post: headers.indexOf('Post'),
            currentRank: headers.indexOf('Current Rank'),
            dateOfRank: headers.indexOf('Date of Rank'),
            retirementDate: headers.indexOf('Retirement Date')
            // Add more mappings if needed
        };
        
        // Process employee data
        employeeData = json.values.slice(1).map(row => {
            return {
                tokenNo: row[columnMapping.tokenNo] || '',
                name: row[columnMapping.name] || '',
                post: row[columnMapping.post] || '',
                currentRank: row[columnMapping.currentRank] || '',
                dateOfRank: row[columnMapping.dateOfRank] || '',
                retirementDate: row[columnMapping.retirementDate] || '',
                // Include all original data for flexibility
                rawData: row
            };
        });
        
        // Extract unique posts for dropdowns
        const posts = [...new Set(employeeData.map(emp => emp.post))].sort();
        populateDropdown('post1-select', posts, 'All Posts');
        populateDropdown('post2-select', posts, 'No second post');
        populateDropdown('retirement-post1', posts, 'All Posts');
        
        console.log('Data loaded successfully:', employeeData.length, 'employees');
    } catch (error) {
        console.error('Error loading data:', error);
        alert('Error loading data: ' + error.message);
    }
}

// [Rest of the code remains exactly the same as in previous implementation]
// Helper functions (populateDropdown, searchByToken, combinePosts, searchRetirements, etc.)
// would follow here unchanged from the previous implementation
</script>