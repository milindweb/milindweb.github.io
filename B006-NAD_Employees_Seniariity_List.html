<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAD Employees Seniority Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #1a3a5f;
            --secondary: #2a5a8c;
            --accent: #3498db;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border: #dee2e6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f4f8;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary);
            font-size: 24px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .header-text {
            line-height: 1.3;
        }
        
        .header-text h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .header-text p {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        /* Sub-header Styles */
        .sub-header {
            background: linear-gradient(to right, var(--accent), #3a7ca5);
            color: white;
            padding: 12px 0;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Main Content Layout */
        .main-content {
            margin-top: 30px;
        }
        
        /* Table Section */
        .table-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .table-header h2 {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-box {
            background-color: #e8f4ff;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 0.9rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }
        
        .export-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .export-excel {
            background-color: #1d6f42;
            color: white;
        }
        
        .export-excel:hover {
            background-color: #165834;
        }
        
        .export-pdf {
            background-color: #d32f2f;
            color: white;
        }
        
        .export-pdf:hover {
            background-color: #b71c1c;
        }
        
        .table-container {
            overflow: auto;
            max-height: 70vh;
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 2000px;
        }
        
        th {
            background-color: var(--primary);
            color: white;
            padding: 12px 14px;
            text-align: left;
            position: sticky;
            top: 0;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            border-right: 1px solid rgba(255,255,255,0.1);
            white-space: nowrap;
            font-size: 0.9rem;
        }
        
        th:last-child {
            border-right: none;
        }
        
        th:hover {
            background-color: #152a41;
        }
        
        th.sort-asc::after {
            content: " ↑";
            font-size: 0.9em;
        }
        
        th.sort-desc::after {
            content: " ↓";
            font-size: 0.9em;
        }
        
        td {
            padding: 10px 14px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
            font-size: 0.85rem;
        }
        
        tr:nth-child(even) {
            background-color: var(--light);
        }
        
        tr:hover {
            background-color: #f1f7ff;
        }
        
        .sort-options {
            display: flex;
            gap: 15px;
            padding: 15px 20px;
            background-color: #f8fbff;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }
        
        .sort-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        .sort-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary);
            font-size: 0.9rem;
        }
        
        .sort-select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: white;
            font-size: 0.9rem;
            width: 100%;
        }
        
        .sort-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .sort-buttons {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .sort-btn {
            padding: 8px 15px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .sort-btn:hover {
            background-color: #2a5a8c;
        }
        
        .reset-btn {
            background-color: var(--gray);
        }
        
        .reset-btn:hover {
            background-color: #5a6268;
        }
        
        /* No Data Message */
        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--gray);
            font-size: 1.1rem;
            font-style: italic;
        }
        
        .no-data i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--light-gray);
        }
        
        /* Loading Indicator */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Footer Styles */
        footer {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 30px 0;
            margin-top: 40px;
        }
        
        .footer-content {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .footer-section {
            flex: 1;
            min-width: 250px;
        }
        
        .footer-section h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-section h3::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--accent);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 12px;
        }
        
        .footer-links a {
            color: #c2e0ff;
            text-decoration: none;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
            color: #a0c8f0;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .export-buttons {
                margin-top: 15px;
                margin-left: 0;
            }
            
            .footer-content {
                flex-direction: column;
            }
            
            .sort-options {
                flex-direction: column;
            }
            
            .sort-buttons {
                align-self: flex-start;
            }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #b8c2cc;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <div class="logo">NAD</div>
                <div class="header-text">
                    <h1>NAD Employees Seniority Management</h1>
                    <p>Seniority tracking and management system</p>
                </div>
            </div>
        </div>
    </header>

    <div class="sub-header">
        Employee Seniority Tracking System
    </div>

    <div class="container">
        <div class="main-content">
            <div class="table-section">
                <div class="table-header">
                    <h2><i class="fas fa-table"></i> Employee Seniority List</h2>
                    <div class="info-box">
                        <i class="fas fa-database"></i> 
                        <span id="employee-count">Loading...</span> employees found
                    </div>
                    <div class="export-buttons">
                        <button class="export-btn export-excel" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i> Excel
                        </button>
                        <button class="export-btn export-pdf" onclick="exportToPDF()">
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                    </div>
                </div>
                
                <div class="sort-options">
                    <div class="sort-group">
                        <label for="year-sort"><i class="fas fa-calendar"></i> Sort by Year</label>
                        <select id="year-sort" class="sort-select" multiple>
                            <option value="Date of Appointment">Appointment Year</option>
                            <option value="Date of Regular">Regularization Year</option>
                            <option value="Date of Retirement">Retirement Year</option>
                        </select>
                    </div>
                    
                    <div class="sort-group">
                        <label for="post-sort"><i class="fas fa-briefcase"></i> Sort by Post</label>
                        <select id="post-sort" class="sort-select" multiple>
                            <option value="Fitter Electrical">Fitter Electrical</option>
                            <option value="Fitter Electronics">Fitter Electronics</option>
                            <option value="Fitter General Mechanic">Fitter General Mechanic</option>
                            <option value="Fitter Armament">Fitter Armament</option>
                        </select>
                    </div>
                    
                    <div class="sort-group">
                        <label for="rank-sort"><i class="fas fa-star"></i> Sort by Rank</label>
                        <select id="rank-sort" class="sort-select" multiple>
                            <option value="HSK-I">HSK-I</option>
                            <option value="HSK-II">HSK-II</option>
                            <option value="SK">SK</option>
                            <option value="SSK">SSK</option>
                            <option value="USL">USL</option>
                        </select>
                    </div>
                    
                    <div class="sort-buttons">
                        <button class="sort-btn" onclick="applyMultiSort()">
                            <i class="fas fa-sort"></i> Apply Sort
                        </button>
                        <button class="sort-btn reset-btn" onclick="resetSort()">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Loading employee data...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>NAD Seniority System</h3>
                <p>A comprehensive solution for managing and tracking employee seniority data with real-time updates from Google Sheets.</p>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#"><i class="fas fa-user-circle"></i> About</a></li>
                    <li><a href="#"><i class="fas fa-file-contract"></i> Policies</a></li>
                    <li><a href="#"><i class="fas fa-question-circle"></i> FAQ</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Resources</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-book"></i> Documentation</a></li>
                    <li><a href="#"><i class="fas fa-download"></i> Downloads</a></li>
                    <li><a href="#"><i class="fas fa-calendar-alt"></i> Important Dates</a></li>
                    <li><a href="#"><i class="fas fa-envelope"></i> Contact</a></li>
                </ul>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2023 NAD Employees Seniority Management System. All rights reserved.
        </div>
    </footer>

    <script>
        // Configuration
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1_qwciFgPC98jL9-4j4p7qLTK639xF0Gkrddp9E4bGQo/export?format=csv";
        
        // Data structure
        let allEmployees = [];
        let filteredEmployees = [];
        
        // DOM Elements
        const tableContainer = document.querySelector('.table-container');
        const employeeCount = document.getElementById('employee-count');
        
        // Initialize the application
        function init() {
            loadData();
        }
        
        // Load data from Google Sheets
        function loadData() {
            Papa.parse(GOOGLE_SHEET_CSV_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    allEmployees = results.data;
                    filteredEmployees = [...allEmployees];
                    
                    // Update employee count
                    employeeCount.textContent = filteredEmployees.length;
                    
                    // Render UI components
                    renderTable();
                    populateSortOptions();
                },
                error: function(error) {
                    console.error("Error loading data:", error);
                    tableContainer.innerHTML = '<div class="no-data"><i class="fas fa-exclamation-triangle"></i><p>Error loading data. Please try again later.</p></div>';
                }
            });
        }
        
        // Populate sort options with unique values
        function populateSortOptions() {
            // Populate year options
            const yearOptions = new Set();
            allEmployees.forEach(emp => {
                if (emp['Date of Appointment']) yearOptions.add(emp['Date of Appointment'].split('/').pop());
                if (emp['Date of Regular']) yearOptions.add(emp['Date of Regular'].split('/').pop());
                if (emp['Date of Retirement']) yearOptions.add(emp['Date of Retirement'].split('/').pop());
            });
            
            const yearSort = document.getElementById('year-sort');
            Array.from(yearOptions).sort().reverse().forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSort.appendChild(option);
            });
            
            // Populate post options
            const postOptions = new Set();
            allEmployees.forEach(emp => {
                if (emp.Post) postOptions.add(emp.Post);
            });
            
            const postSort = document.getElementById('post-sort');
            Array.from(postOptions).sort().forEach(post => {
                const option = document.createElement('option');
                option.value = post;
                option.textContent = post;
                postSort.appendChild(option);
            });
            
            // Populate rank options
            const rankOptions = new Set();
            allEmployees.forEach(emp => {
                if (emp.Rank) rankOptions.add(emp.Rank);
            });
            
            const rankSort = document.getElementById('rank-sort');
            Array.from(rankOptions).sort().forEach(rank => {
                const option = document.createElement('option');
                option.value = rank;
                option.textContent = rank;
                rankSort.appendChild(option);
            });
        }
        
        // Apply multi-sort based on selected options
        function applyMultiSort() {
            const selectedYears = Array.from(document.getElementById('year-sort').selectedOptions).map(o => o.value);
            const selectedPosts = Array.from(document.getElementById('post-sort').selectedOptions).map(o => o.value);
            const selectedRanks = Array.from(document.getElementById('rank-sort').selectedOptions).map(o => o.value);
            
            // Filter employees based on selections
            filteredEmployees = allEmployees.filter(emp => {
                // Check year filters
                let yearMatch = false;
                if (selectedYears.length > 0) {
                    const appYear = emp['Date of Appointment'] ? emp['Date of Appointment'].split('/').pop() : '';
                    const regYear = emp['Date of Regular'] ? emp['Date of Regular'].split('/').pop() : '';
                    const retYear = emp['Date of Retirement'] ? emp['Date of Retirement'].split('/').pop() : '';
                    
                    yearMatch = selectedYears.some(year => 
                        year === appYear || year === regYear || year === retYear
                    );
                } else {
                    yearMatch = true;
                }
                
                // Check post filter
                const postMatch = selectedPosts.length === 0 || selectedPosts.includes(emp.Post);
                
                // Check rank filter
                const rankMatch = selectedRanks.length === 0 || selectedRanks.includes(emp.Rank);
                
                return yearMatch && postMatch && rankMatch;
            });
            
            // Update employee count
            employeeCount.textContent = filteredEmployees.length;
            
            // Render the table
            renderTable();
        }
        
        // Reset sort filters
        function resetSort() {
            document.getElementById('year-sort').selectedIndex = -1;
            document.getElementById('post-sort').selectedIndex = -1;
            document.getElementById('rank-sort').selectedIndex = -1;
            
            filteredEmployees = [...allEmployees];
            employeeCount.textContent = filteredEmployees.length;
            renderTable();
        }
        
        // Render employee table with all columns
        function renderTable() {
            if (filteredEmployees.length === 0) {
                tableContainer.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-database"></i>
                        <p>No employees found matching the selected criteria</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <table id="employee-table">
                    <thead>
                        <tr>
                            <th data-sort="SrNo">SrNo</th>
                            <th data-sort="Name">Name</th>
                            <th data-sort="Post">Post</th>
                            <th data-sort="Rank">Rank</th>
                            <th data-sort="Tokan No">Token No</th>
                            <th data-sort="Category">Category</th>
                            <th data-sort="Location">Location</th>
                            <th data-sort="Date of Birth">Date of Birth</th>
                            <th data-sort="Date of Retirement">Retirement Date</th>
                            <th data-sort="Date of Appointment">Appointment Date</th>
                            <th data-sort="Date of Regular">Regularization Date</th>
                            <th data-sort="Dept Qualify Examination">Dept Qualify Exam</th>
                            <th data-sort="Date of Tradesman Mate">Tradesman Mate Date</th>
                            <th data-sort="Date of USL">USL Date</th>
                            <th data-sort="Date of SSK">SSK Date</th>
                            <th data-sort="Date of SK">SK Date</th>
                            <th data-sort="Date of HSK 2">HSK2 Date</th>
                            <th data-sort="Date of HSK 1">HSK1 Date</th>
                            <th data-sort="Date of MCM">MCM Date</th>
                            <th data-sort="Remark">Remark</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredEmployees.forEach(emp => {
                tableHTML += `
                    <tr>
                        <td>${emp.SrNo || ''}</td>
                        <td>${emp.Name || ''}</td>
                        <td>${emp.Post || ''}</td>
                        <td>${emp.Rank || ''}</td>
                        <td>${emp['Tokan No'] || ''}</td>
                        <td>${emp.Category || ''}</td>
                        <td>${emp.Location || ''}</td>
                        <td>${emp['Date of Birth'] || ''}</td>
                        <td>${emp['Date of Retirement'] || ''}</td>
                        <td>${emp['Date of Appointment'] || ''}</td>
                        <td>${emp['Date of Regular'] || ''}</td>
                        <td>${emp['Dept Qualify Examination'] || ''}</td>
                        <td>${emp['Date of Tradesman Mate'] || ''}</td>
                        <td>${emp['Date of USL'] || ''}</td>
                        <td>${emp['Date of SSK'] || ''}</td>
                        <td>${emp['Date of SK'] || ''}</td>
                        <td>${emp['Date of HSK 2'] || ''}</td>
                        <td>${emp['Date of HSK 1'] || ''}</td>
                        <td>${emp['Date of MCM'] || ''}</td>
                        <td>${emp.Remark || ''}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            tableContainer.innerHTML = tableHTML;
            
            // Add sorting functionality
            document.querySelectorAll('#employee-table th').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.getAttribute('data-sort');
                    sortTable(column);
                });
            });
        }
        
        // Sort table by column
        function sortTable(column) {
            const table = document.getElementById('employee-table');
            const headers = table.querySelectorAll('th');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Remove existing sort indicators
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });
            
            // Determine sort direction
            const currentHeader = table.querySelector(`th[data-sort="${column}"]`);
            const isAsc = currentHeader.classList.contains('sort-asc');
            const direction = isAsc ? -1 : 1;
            
            // Update sort indicator
            currentHeader.classList.toggle('sort-asc', !isAsc);
            currentHeader.classList.toggle('sort-desc', isAsc);
            
            // Sort rows
            rows.sort((a, b) => {
                const aValue = a.querySelector(`td:nth-child(${Array.from(headers).findIndex(h => h.getAttribute('data-sort') === column) + 1}`).textContent;
                const bValue = b.querySelector(`td:nth-child(${Array.from(headers).findIndex(h => h.getAttribute('data-sort') === column) + 1}`).textContent;
                
                // Try to compare as numbers if possible
                if (!isNaN(aValue) && !isNaN(bValue)) {
                    return (parseFloat(aValue) - parseFloat(bValue)) * direction;
                }
                
                // Compare as dates (simple format detection)
                const dateRegex = /(\d{1,2})[\/-](\d{1,2})[\/-](\d{4})/;
                const aDateMatch = aValue.match(dateRegex);
                const bDateMatch = bValue.match(dateRegex);
                
                if (aDateMatch && bDateMatch) {
                    const aDate = new Date(`${aDateMatch[3]}-${aDateMatch[2]}-${aDateMatch[1]}`);
                    const bDate = new Date(`${bDateMatch[3]}-${bDateMatch[2]}-${bDateMatch[1]}`);
                    return (aDate - bDate) * direction;
                }
                
                // Default to string comparison
                return aValue.localeCompare(bValue) * direction;
            });
            
            // Re-append rows in sorted order
            rows.forEach(row => tbody.appendChild(row));
        }
        
        // Export to Excel function
        function exportToExcel() {
            if (filteredEmployees.length === 0) {
                alert('No data to export');
                return;
            }
            
            // Prepare the data for export
            const dataForExport = filteredEmployees.map(emp => ({
                "SrNo": emp.SrNo,
                "Name": emp.Name,
                "Post": emp.Post,
                "Rank": emp.Rank,
                "Token No": emp['Tokan No'],
                "Category": emp.Category,
                "Location": emp.Location,
                "Date of Birth": emp['Date of Birth'],
                "Retirement Date": emp['Date of Retirement'],
                "Appointment Date": emp['Date of Appointment'],
                "Regularization Date": emp['Date of Regular'],
                "Dept Qualify Exam": emp['Dept Qualify Examination'],
                "Tradesman Mate Date": emp['Date of Tradesman Mate'],
                "USL Date": emp['Date of USL'],
                "SSK Date": emp['Date of SSK'],
                "SK Date": emp['Date of SK'],
                "HSK2 Date": emp['Date of HSK 2'],
                "HSK1 Date": emp['Date of HSK 1'],
                "MCM Date": emp['Date of MCM'],
                "Remark": emp.Remark
            }));
            
            // Create worksheet
            const worksheet = XLSX.utils.json_to_sheet(dataForExport);
            
            // Create workbook
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Employees");
            
            // Generate Excel file
            XLSX.writeFile(workbook, `NAD_Employees_${new Date().toISOString().slice(0,10)}.xlsx`);
        }
        
        // Export to PDF function
        function exportToPDF() {
            if (filteredEmployees.length === 0) {
                alert('No data to export');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            
            // Add title
            doc.setFontSize(18);
            doc.text('NAD Employees Seniority List', 15, 15);
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 15, 22);
            doc.text(`Total Employees: ${filteredEmployees.length}`, 15, 29);
            
            // Prepare table data
            const tableColumn = [
                "SrNo", "Name", "Post", "Rank", "Token No", "Category", "Location", 
                "Date of Birth", "Retirement Date", "Appointment Date", "Regularization Date",
                "Dept Qualify Exam", "Tradesman Mate Date", "USL Date", "SSK Date", 
                "SK Date", "HSK2 Date", "HSK1 Date", "MCM Date", "Remark"
            ];
            
            const tableRows = filteredEmployees.map(emp => [
                emp.SrNo || '',
                emp.Name || '',
                emp.Post || '',
                emp.Rank || '',
                emp['Tokan No'] || '',
                emp.Category || '',
                emp.Location || '',
                emp['Date of Birth'] || '',
                emp['Date of Retirement'] || '',
                emp['Date of Appointment'] || '',
                emp['Date of Regular'] || '',
                emp['Dept Qualify Examination'] || '',
                emp['Date of Tradesman Mate'] || '',
                emp['Date of USL'] || '',
                emp['Date of SSK'] || '',
                emp['Date of SK'] || '',
                emp['Date of HSK 2'] || '',
                emp['Date of HSK 1'] || '',
                emp['Date of MCM'] || '',
                emp.Remark || ''
            ]);
            
            // Add table to PDF
            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: 35,
                theme: 'grid',
                styles: { fontSize: 7, cellPadding: 1.5 },
                headStyles: { fillColor: [26, 58, 95], textColor: 255, fontStyle: 'bold' },
                alternateRowStyles: { fillColor: [240, 240, 240] },
                margin: { left: 10 },
                didDrawPage: function (data) {
                    // Footer
                    doc.setFontSize(10);
                    doc.text('NAD Employees Seniority Management System', 
                        data.settings.margin.left, 
                        doc.internal.pageSize.height - 10
                    );
                }
            });
            
            // Save the PDF
            doc.save(`NAD_Employees_${new Date().toISOString().slice(0,10)}.pdf`);
        }
        
        // Initialize the application when the page loads
        window.addEventListener('DOMContentLoaded', init);
        
        // Expose functions for HTML onclick
        window.applyMultiSort = applyMultiSort;
        window.resetSort = resetSort;
        window.exportToExcel = exportToExcel;
        window.exportToPDF = exportToPDF;
    </script>
</body>
</html>
