<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Employee Seniority List</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f4f4f4;
      color: #333;
      margin: 0;
    }
    header, footer {
      background-color: #003366;
      color: white;
      text-align: center;
      padding: 12px;
    }
    h1 { margin: 0; font-size: 22px; }
    h2 { font-size: 18px; margin-bottom: 5px; }

    .container {
      padding: 15px;
    }
    .rank-group {
      background-color: #e0e0e0;
      margin-bottom: 8px;
      border-radius: 6px;
      padding: 8px;
    }
    .rank-header {
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
      background-color: #d3d3d3;
      padding: 6px;
      border-radius: 5px;
    }
    .employee-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }
    .employee-table th, .employee-table td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    .employee-table th {
      background-color: #f1f1f1;
    }
    .collapsed {
      display: none;
    }

    @media (max-width: 768px) {
      .employee-table {
        font-size: 11px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“‹ NAD Employees Seniority List</h1>
  </header>

  <div class="container" id="employeeContainer">
    <p>Loading employee data...</p>
  </div>

  <footer>
    <p>&copy; 2025 NAD Employee Records | <a href="https://milindweb.github.io" style="color: #ddd;">milindweb.github.io</a></p>
  </footer>

  <script>
    const sheetCSVUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTXEY1TLuvDDTVYPqtTP7JwsQ6UTMw03ozLNFtXFLJezmCtvznx3tsdch8Dvm-35zkxMm0Oar40Sn2X/pub?gid=0&single=true&output=csv';

    const container = document.getElementById("employeeContainer");

    function groupByDepartment(data) {
      const groups = {};
      data.forEach(row => {
        const rank = row["Rank"] || "Unknown";
        let mainDept = "Others";
        if (rank.includes("Electrical")) mainDept = "Electrical";
        else if (rank.includes("Electronics")) mainDept = "Electronics";
        else if (rank.includes("General")) mainDept = "General Mechanic";
        else if (rank.includes("Armament")) mainDept = "Armament";
        else if (rank.includes("Tradesman")) mainDept = "Tradesman";

        if (!groups[mainDept]) groups[mainDept] = {};
        if (!groups[mainDept][rank]) groups[mainDept][rank] = [];

        groups[mainDept][rank].push(row);
      });
      return groups;
    }

    function createTable(employees) {
      const table = document.createElement("table");
      table.className = "employee-table";

      const headers = [
        "SrNo.", "Name", "Rank", "Tokan No.", "Category", "Location", "Date of Birth", "Date of Retirement",
        "Date of Appointment", "Date of Regular", "Dept Qualify Examination", "Date of USL", "Date of SSK", 
        "Date of SK", "Date of HSK 2", "Date of HSK 1", "Date of MCM", "Pin", "Mobile No.", "Email", "Remark"
      ];
      const thead = document.createElement("thead");
      const headRow = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headRow.appendChild(th);
      });
      thead.appendChild(headRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      employees.forEach(emp => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          td.textContent = emp[h] || "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      return table;
    }

    function displayAllEmployees(grouped) {
      container.innerHTML = "";

      Object.entries(grouped).forEach(([mainDept, subranks]) => {
        const deptSection = document.createElement("div");
        deptSection.className = "rank-group";

        const deptHeader = document.createElement("h2");
        deptHeader.textContent = `ðŸ“ ${mainDept}`;
        deptSection.appendChild(deptHeader);

        Object.entries(subranks).forEach(([rank, employees]) => {
          const subRankHeader = document.createElement("div");
          subRankHeader.className = "rank-header";
          subRankHeader.textContent = `â–¶ ${rank} (${employees.length})`;

          const subRankTable = createTable(employees);
          subRankTable.classList.add("collapsed");

          subRankHeader.addEventListener("click", () => {
            subRankTable.classList.toggle("collapsed");
          });

          deptSection.appendChild(subRankHeader);
          deptSection.appendChild(subRankTable);
        });

        container.appendChild(deptSection);
      });
    }

    // Load and parse
    Papa.parse(sheetCSVUrl, {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data.filter(r => r["Rank"]); // basic filter
        const grouped = groupByDepartment(data);
        displayAllEmployees(grouped);
      },
      error: function(err) {
        container.innerHTML = `<p>Error loading data: ${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
