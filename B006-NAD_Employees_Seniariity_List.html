<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NAD Employees Seniority List</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f9fc;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      color: #0d47a1;
      text-align: center;
    }
    details summary {
      cursor: pointer;
      font-weight: bold;
      background: #2196f3;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
    }
    details details summary {
      background: #64b5f6;
      margin-left: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 14px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
    }
    th {
      background: #1976d2;
      color: white;
      position: sticky;
      top: 0;
    }
    tr:nth-child(even) {
      background: #f1f1f1;
    }
    .footer {
      margin-top: 40px;
      text-align: center;
      font-size: 12px;
      color: #777;
    }
  </style>
</head>
<body>

  <h1>NAD Employees Seniority List</h1>

  <div id="hierarchyContainer">Loading...</div>

  <div class="footer">
    &copy; 2025 NAD Employees | Powered by <a href="https://milindweb.github.io" target="_blank">milindweb.github.io</a>
  </div>

  <script>
    const sheetID = "1Fe2GeVPkxSY7RzPO6GQ9CTqZ_TqxbJKT6IfhT4ijzA4";
    const sheetName = "Sheet1";
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
    let employeeData = [];

    const rankGroups = {
      "Electrical": ["SK", "HSK 2", "HSK 1", "MCM"],
      "Electronics": ["SK", "HSK 2", "HSK 1", "MCM"],
      "General Mechanic": ["Fitter General Mechanic"],
      "Armament": ["Armament Fitter"],
      "Tradesman": ["Tradesman Mate"],
      "Other": []
    };

    fetch(url)
      .then(res => res.text())
      .then(rep => {
        const jsonData = JSON.parse(rep.substring(47).slice(0, -2));
        const cols = jsonData.table.cols.map(col => col.label);
        employeeData = jsonData.table.rows.map(row => {
          const obj = {};
          row.c.forEach((cell, idx) => {
            obj[cols[idx]] = cell ? cell.v : "";
          });
          return obj;
        });
        displayHierarchy();
      })
      .catch(err => {
        document.getElementById("hierarchyContainer").innerHTML = "Error loading data.";
        console.error("Error:", err);
      });

    function getSubCategory(rank) {
      if (rank.includes("Electrical")) return "Electrical";
      if (rank.includes("Electronics")) return "Electronics";
      if (rank.includes("General Mechanic")) return "General Mechanic";
      if (rank.includes("Armament")) return "Armament";
      if (rank.includes("Tradesman")) return "Tradesman";
      return "Other";
    }

    function displayHierarchy() {
      const container = document.getElementById("hierarchyContainer");
      container.innerHTML = "";

      const grouped = {};

      employeeData.forEach(emp => {
        const mainCat = getSubCategory(emp["Rank"]);
        const subCat = emp["Rank"];
        if (!grouped[mainCat]) grouped[mainCat] = {};
        if (!grouped[mainCat][subCat]) grouped[mainCat][subCat] = [];
        grouped[mainCat][subCat].push(emp);
      });

      for (const [mainCat, subRanks] of Object.entries(grouped)) {
        const detailsMain = document.createElement("details");
        const summaryMain = document.createElement("summary");
        summaryMain.textContent = mainCat;
        detailsMain.appendChild(summaryMain);

        for (const [subRank, members] of Object.entries(subRanks)) {
          const detailsSub = document.createElement("details");
          const summarySub = document.createElement("summary");
          summarySub.textContent = `${subRank} (${members.length})`;
          detailsSub.appendChild(summarySub);
          detailsSub.appendChild(buildTable(members));
          detailsMain.appendChild(detailsSub);
        }

        container.appendChild(detailsMain);
      }
    }

    function buildTable(dataArray) {
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const tbody = document.createElement("tbody");

      const headers = [
        "SrNo.", "Name", "Rank", "Tokan No.", "Category", "Location", "Date of Birth",
        "Date of Retirement", "Date of Appointment", "Date of Regular",
        "Dept Qualify Examination", "Date of USL", "Date of SSK", "Date of SK",
        "Date of HSK 2", "Date of HSK 1", "Date of MCM", "Pin", "Mobile No.", "Email", "Remark"
      ];

      const trHead = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);
      table.appendChild(thead);

      dataArray.forEach(emp => {
        const tr = document.createElement("tr");
        headers.forEach(col => {
          const td = document.createElement("td");
          td.textContent = emp[col] || "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      return table;
    }
  </script>
</body>
</html>
