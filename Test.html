<script>
  const form = document.getElementById('contactForm');
  const responseBox = document.getElementById('responseMessage');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Show loading state
    responseBox.textContent = "⏳ Submitting...";
    responseBox.style.color = "#000";

    try {
      // Get IP address first
      const ipRes = await fetch("https://api.ipify.org?format=json");
      const ipData = await ipRes.json();
      const ip = ipData.ip || "Unknown";
      
      // Create hidden input for IP
      const ipInput = document.createElement('input');
      ipInput.type = 'hidden';
      ipInput.name = 'ip';
      ipInput.value = ip;
      form.appendChild(ipInput);
      
      // Submit form traditionally
      const response = await fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        redirect: 'follow'
      });
      
      // Parse HTML response (Google Apps Script returns HTML)
      const text = await response.text();
      
      // Check for success message
      if (text.includes('✅ Contact Form Web App is active')) {
        responseBox.textContent = "✅ Submitted successfully! Our team will reach out to you shortly.";
        responseBox.style.color = "green";
        form.reset();
      } else {
        responseBox.textContent = "❌ Submission failed. Please try again or contact us directly.";
        responseBox.style.color = "red";
      }
      
      // Remove temporary IP field
      form.removeChild(ipInput);
      
    } catch (err) {
      responseBox.textContent = "⚠️ Network error: " + err.message;
      responseBox.style.color = "red";
    }
    
    // Clear message after 15 seconds
    setTimeout(() => { responseBox.textContent = ""; }, 15000);
  });
</script>
